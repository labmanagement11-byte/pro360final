# üîß SOLUCI√ìN FINAL: Error "violates row-level security policy"

## ‚ùå El Error que ves

```
Error al guardar: new row violates row-level security policy for table "checklist"
```

**Causa:** Las pol√≠ticas RLS de Supabase bloquean la inserci√≥n porque no est√°n configuradas correctamente para usuarios autenticados.

## ‚úÖ SOLUCI√ìN DEFINITIVA

### 1Ô∏è‚É£ Abre Supabase Dashboard
- Ve a: https://supabase.com/dashboard/
- Selecciona tu proyecto

### 2Ô∏è‚É£ Abre SQL Editor
- Men√∫ izquierdo ‚Üí "SQL Editor"
- Clic en "New Query"

### 3Ô∏è‚É£ Copia TODO este c√≥digo SQL

**‚ö†Ô∏è IMPORTANTE: Copia TODO, desde el `--` hasta el final**

```sql
DROP TABLE IF EXISTS checklist CASCADE;

CREATE TABLE checklist (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
  house TEXT NOT NULL,
  item TEXT NOT NULL,
  room TEXT,
  complete BOOLEAN DEFAULT FALSE,
  assigned_to TEXT DEFAULT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE INDEX idx_checklist_house ON checklist(house);
CREATE INDEX idx_checklist_house_complete ON checklist(house, complete);
CREATE INDEX idx_checklist_created_at ON checklist(created_at);

ALTER TABLE checklist ENABLE ROW LEVEL SECURITY;

DROP POLICY IF EXISTS "allow_select" ON checklist;
DROP POLICY IF EXISTS "allow_insert" ON checklist;
DROP POLICY IF EXISTS "allow_update" ON checklist;
DROP POLICY IF EXISTS "allow_delete" ON checklist;
DROP POLICY IF EXISTS "Users can select checklist items" ON checklist;
DROP POLICY IF EXISTS "Managers can insert checklist items" ON checklist;
DROP POLICY IF EXISTS "Users can update checklist items" ON checklist;
DROP POLICY IF EXISTS "Managers can delete checklist items" ON checklist;

CREATE POLICY "allow_select" ON checklist
  FOR SELECT USING (auth.role() = 'authenticated');

CREATE POLICY "allow_insert" ON checklist
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "allow_update" ON checklist
  FOR UPDATE USING (auth.role() = 'authenticated') 
  WITH CHECK (auth.role() = 'authenticated');

CREATE POLICY "allow_delete" ON checklist
  FOR DELETE USING (auth.role() = 'authenticated');

SELECT 'Tabla configurada' as status, COUNT(*) as registros FROM checklist;
```

### 4Ô∏è‚É£ Ejecuta el script
- Clic en bot√≥n ‚ñ∂ **Run** (o Ctrl+Enter)
- Espera a que complete
- Deber√≠as ver: `Tabla configurada | 0`

### 5Ô∏è‚É£ Prueba en Dashboard
1. **Recarga completamente:** Ctrl+Shift+F5
2. **Intenta agregar una tarea** al checklist
3. **Recarga de nuevo:** Ctrl+Shift+F5
4. **¬øLa tarea est√° ah√≠?** 
   - ‚úÖ **S√ç** ‚Üí ¬°Funciona! Ve al paso 6
   - ‚ùå **NO** ‚Üí Ve a "Debugging" abajo

### 6Ô∏è‚É£ Prueba sincronizaci√≥n en tiempo real

**En 2 navegadores/ventanas diferentes:**

**Navegador 1 (Sandra):**
- Dashboard ‚Üí ‚úÖ Checklist
- Agrega: "Limpiar ventanas"
- NO recargues

**Navegador 2 (Chava):**
- Dashboard ‚Üí ‚úÖ Checklist
- ¬øVes "Limpiar ventanas" aparecer en tiempo real?
  - ‚úÖ **S√ç** ‚Üí Sincronizaci√≥n perfecta ‚úÖ
  - ‚ùå **NO** ‚Üí Recarga la p√°gina de Chava

## üÜò Debugging si sigue sin funcionar

### Paso 1: Verifica en Supabase

Ve a Supabase Dashboard ‚Üí "Table Editor":

**¬øExiste tabla "checklist"?**
- ‚úÖ S√ç ‚Üí Ir a Paso 2
- ‚ùå NO ‚Üí Re-ejecuta TODO el script SQL arriba

**Paso 2: Verifica tabla tiene datos**

En "Table Editor", selecciona "checklist":
- ¬øTiene columnas: id, house, item, room, complete, assigned_to?
  - ‚úÖ S√ç ‚Üí Ir a Paso 3
  - ‚ùå NO ‚Üí Re-ejecuta el script

**Paso 3: Abre consola del navegador**

Presiona **F12**:
- Pesta√±a "Console"
- Intenta agregar una tarea
- ¬øHay errores rojos?
- Copia el error COMPLETO y mu√©stramelo

### Paso 4: Verifica pol√≠ticas RLS

En Supabase ‚Üí "checklist" tabla:
- Pesta√±a "RLS"
- ¬øVes 4 pol√≠ticas?: allow_select, allow_insert, allow_update, allow_delete
  - ‚úÖ S√ç ‚Üí Todo est√° bien, problema es en el cliente
  - ‚ùå NO ‚Üí Re-ejecuta el script SQL

## ‚ú® Checklist de configuraci√≥n correcta

```
‚úÖ Tabla "checklist" existe
‚úÖ Tiene columnas: id, house, item, room, complete, assigned_to, created_at, updated_at
‚úÖ RLS est√° ENABLED (activado)
‚úÖ Tiene 4 pol√≠ticas con auth.role() = 'authenticated'
‚úÖ √çndices creados: idx_checklist_house, idx_checklist_house_complete
‚úÖ Script ejecutado sin errores
```

Si tienes ‚úÖ en TODO, deber√≠a funcionar.
