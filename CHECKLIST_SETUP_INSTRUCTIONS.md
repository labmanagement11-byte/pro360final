# ğŸ”§ SOLUCIÃ“N: Error "violates row-level security policy"

## âŒ El Error que ves

```
Error al guardar: new row violates row-level security policy for table "checklist"
```

## âœ… SOLUCIÃ“N EN 5 PASOS

### 1ï¸âƒ£ Abre Supabase Dashboard
- Ve a: https://supabase.com/dashboard/
- Selecciona tu proyecto

### 2ï¸âƒ£ Abre SQL Editor
- MenÃº izquierdo â†’ "SQL Editor"
- Clic en "New Query"

### 3ï¸âƒ£ Copia TODO este cÃ³digo SQL

```sql
ALTER TABLE IF EXISTS checklist DISABLE ROW LEVEL SECURITY;
CREATE TABLE IF NOT EXISTS checklist (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
  house TEXT NOT NULL,
  item TEXT NOT NULL,
  room TEXT,
  complete BOOLEAN DEFAULT FALSE,
  assigned_to TEXT DEFAULT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
DROP INDEX IF EXISTS idx_checklist_house;
DROP INDEX IF EXISTS idx_checklist_house_complete;
CREATE INDEX idx_checklist_house ON checklist(house);
CREATE INDEX idx_checklist_house_complete ON checklist(house, complete);
DROP POLICY IF EXISTS "Users can select checklist items" ON checklist;
DROP POLICY IF EXISTS "Managers can insert checklist items" ON checklist;
DROP POLICY IF EXISTS "Users can update checklist items" ON checklist;
DROP POLICY IF EXISTS "Managers can delete checklist items" ON checklist;
SELECT 'Tabla configurada' as status, COUNT(*) as registros FROM checklist;
```

### 4ï¸âƒ£ Ejecuta el script
- Clic en botÃ³n â–¶ **Run** (o Ctrl+Enter)
- DeberÃ­as ver: `Tabla configurada | 0`

### 5ï¸âƒ£ Prueba en Dashboard
1. Recarga el sitio (Ctrl+F5)
2. Agrega una tarea al checklist
3. Recarga la pÃ¡gina (Ctrl+F5)
4. **Â¡La tarea debe seguir ahÃ­!** âœ…

## ğŸ§ª VerificaciÃ³n Completa

DespuÃ©s de ejecutar el script, prueba esto:

**Test 1 - Sandra agrega tarea**
- Dashboard â†’ âœ… Checklist
- Agrega: "Limpiar piso"
- Recarga pÃ¡gina
- Â¿Sigue "Limpiar piso"? **SÃ­ = âœ… Funciona**

**Test 2 - Chava ve la tarea**
- Abre navegador diferente (o incÃ³gnito)
- Inicia como Chava
- Dashboard â†’ âœ… Checklist
- Â¿Ves "Limpiar piso"? **SÃ­ = âœ… SincronizaciÃ³n OK**

**Test 3 - Completar tarea**
- Chava marca "Limpiar piso" como completada
- Recarga
- Â¿Sigue completada? **SÃ­ = âœ… Todo OK**

## ğŸ†˜ Debugging si falla

**Paso 1: Verifica en Supabase que existe la tabla**
- Dashboard â†’ "Table Editor"
- Â¿Ves "checklist" en la lista? 
  - âœ… SÃ­ â†’ Ir a Paso 2
  - âŒ No â†’ Re-ejecuta el SQL arriba

**Paso 2: Verifica que RLS estÃ¡ disabled**
- Haz clic en tabla "checklist"
- PestaÃ±a "RLS"
- Â¿EstÃ¡ desactivado (gris)?
  - âœ… SÃ­ â†’ Ir a Paso 3
  - âŒ No â†’ DesactÃ­valo manualmente

**Paso 3: Abre consola navegador (F12)**
- PestaÃ±a "Console"
- Intenta agregar una tarea
- Â¿Hay errores rojos?
- Copia el error exacto y muÃ©stramelo

## âœ¨ Resultado esperado

En Supabase â†’ Table Editor, tabla "checklist" deberÃ­a tener:

```
Columnas:
âœ… id (bigint, PK)
âœ… created_at (timestamp)
âœ… house (text) - Ej: "HYNTIBA2 APTO 406"
âœ… item (text) - Ej: "Limpiar pisos"
âœ… room (text) - Ej: "LIMPIEZA PROFUNDA"
âœ… complete (boolean)
âœ… assigned_to (text)
âœ… updated_at (timestamp)

RLS: DISABLED âœ…
```

Si ves esto, Â¡estÃ¡ perfecto!
